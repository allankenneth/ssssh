<!doctype HTML>
<html lang="en">
<head>
<title>Ssssh! Victoria BC Quiet District Noise Bylaws Made Plain</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
<script>
// Refresh on the new minute
let d = new Date();
setTimeout(function() { location.reload() }, 1000 * (60 - d.getSeconds()));
</script>
</head>
<body class="bg-light">
<h1 class="text-center">
    <span class="fs-3">Victoria, BC</span><br>
    <span class="display-4 fw-bold">Quiet District Noise Bylaws</span><br>
    <span class="display-5 text-uppercase">Made Plain</span>
</h1>
<div class="bg-white">
<div class="container bg-white">
<div class="row pt-3 pb-5">

<div class="col-12" id="app"></div>

</div>
</div>
</div>
<div style="height: 100px"></div>
<div class="container">
<div class="row pt-3">
<div class="col-12 text-center">
  <a class="btn btn-lg btn-primary mb-6" href="https://www.victoria.ca/assets/City~Hall/Bylaws/bylaw-03-012.pdf" target="_blank" rel="nofollow">
    Read the Noise Bylaws
  </a>
  <a class="btn btn-lg btn-primary mb-6" href="https://www.victoria.ca/assets/City~Hall/Bylaws/bylaw-03-012-map.pdf" target="_blank" rel="nofollow">
    View the Noise District Map
  </a>
  <a class="btn btn-lg btn-primary mb-6" href="https://www.victoria.ca/EN/main/city/bylaw-enforcement/report-a-bylaw-violation.html" target="_blank" rel="nofollow">
    Report a Violation
  </a>
</div>
<div style="height: 120px"></div>
</div>
</div>
</div>
<div class="bg-black text-white">
<div class="container">
<div class="row">
<div class="col-md-8">
<div class="py-5">
        <h1>About</h1>
        <p>Ssssh! is not affiliated with the City of Victoria, British Columbia in any way and is
        not guaranteed to be accurate. The display is based on a reading of the bylaws and a custom
        data representation derived from that. You can 
        <a style="color: #FFF;" href="https://github.com/allankenneth/ssssh">view the code on GitHub</a>
        .</p>
        <p>Ssssh! was created in the spirit that more people would follow the bylaws and be respectful
        of their neighbors if they had an easy way to check the bylaws that didn't involve reading a 
        20 page PDF to find the relevant section relative to the current date and time.</p>
        
        <a class="btn btn-primary mb-6" href="https://www.victoria.ca/assets/City~Hall/Bylaws/bylaw-03-012.pdf">Download Bylaw PDF</a>
        <div style="height: 200px"></div>
</div>
</div>
<div class="col-md-4">
<div class="py-5">
  <h2>Acknowledgement</h2>
  <p class="fs-4">This website pertains to noise bylaws in the city of Victoria, BC which exists 
  on the unceded territories of the Lekwungen peoples, today known as the Songhees 
  and Esquimalt nations.</p>
</div>
</div>
</div>
</div>
</div>
<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=Promise"></script>
<script src="https://unpkg.com/dayjs-with-plugins"></script>

<script>

const year = dayjs().format('YYYY');
const today = dayjs().format('YYYY-MM-DD');
const tomorrow = dayjs().add(1,'day');
const loadedon = dayjs().format('dddd[,] MMMM D [at] h:mm');
const day = dayjs().format('d');
const hour = dayjs().format('HH');
const time = dayjs().format('HH:mm')

/**
* Holidays
*
* (a) New Yearâ€™s Day, Good Friday, Easter Monday, Victoria Day, Canada Day,
* British Columbia Day, Labour Day, Thanksgiving Day, Remembrance Day,
* Christmas Day and December 26, and
* (b) the day following a day that is named in paragraph (a) and that falls on a Sunday;
*
**/
let sssshday = '2022-10-04';
let newyearsday = year + '-01-01';

let longre = easterDateLLongre(year);
let easter = longre[0] + '-' + longre[1] + '-' + longre[2];
//console.log(easter);
//let gf = new DateTime(easter);
//let goodf = gf->sub(new DateInterval('P3D'));
let goodfriday = year + '-05-01'; //goodf->format('Y-m-d');
//let victoriaday = year + '-05-02'; //date('Y-m-d', strtotime("last monday before may 25 let year"));
let canadaday = year + '-07-01';
let bcday = year + '-07-01'; //date('Y-m-d', strtotime("first monday of august let year"));
let labourday = year + '-07-01'; //date('Y-m-d', strtotime("first monday of september let year"));
let thanksgiving = year + '-07-01'; //date('Y-m-d', strtotime("second monday of october let year"));
let rememberanceday = year + '-11-11';
let xmasday = year + '-12-25';
let boxingday = year + '-12-26';
let victoriaday = year + '-01-01'; // observed on the Monday before May 25th each year
let holidays = [
               newyearsday,
               goodfriday,
               easter,
               victoriaday,
               canadaday,
               bcday,
               labourday,
               thanksgiving,
               rememberanceday,
               xmasday,
               boxingday
       ];

let dayrange = '';
let tomorrowrange = '';
let holiday = false;
if (holidays.includes(today) == true) {
  dayrange = 'Holiday';
  holiday = true;
} else if (day == 1 || day == 2 || day == 3 || day == 4 || day == 5) {
  dayrange = 'Weekdays';
} else if (day == 6) {
  dayrange = 'Saturday';
} else if (day == 0) {
  dayrange = 'Holiday';
}

(async () => {
  const res = await fetch('https://raw.githubusercontent.com/allankenneth/ssssh/main/bylaws.json', {
    headers: { Accept: 'application/json' },
  });
  const json = await res.json();
  var count = 0;
  var output = '<div class="mb-3 text-center text-uppercase fs-3">It is ' + loadedon + '</div>';
  if(holiday == true) {
    output += '<div class="text-center fw-bold pb-3">IT\'S A HOLIDAY!</div>';
  }
  
  output += '<div class="row">';
  Object.entries(json).forEach(([key, zone]) => {
    zone[0].types.forEach((type) => {
      count++;
      output += '<div class="col-md-6 col-lg-4">';
      let header = '<h3>' + type.type + ' ';
      header += '<a href="#desc' + count + '" data-bs-toggle="collapse" href="#desc' + count + '" role="button" aria-expanded="false" aria-controls="#desc' + count + '" class="alert-link">';
      header += '<i class="bi bi-question-circle fs-5 inline-block ml-2 p-1"></i></a>';
      header += '</h3>'; //  <a href="#"><i class="bi bi-question-circle"></i></a>
      type.ranges.forEach((range) => {
        if(dayrange == range.name) {
          let status = 0;
          let timerange = '<div>' + range.start + ' - ';
          timerange += '' + range.end + '</div>';
          if(time > range.start && time < range.end) {
            status = 1;
          }
          let fullnow = dayjs(today + 'T' + time);
          if(status) {
            
            let rend = dayjs(today+'T'+range.end);
            let hoursleft = dayjs.duration(rend.diff(fullnow));
            output += '<div class="alert alert-success text-center">';
            output += header;
            output += timerange;
            output += '<div id="desc' + count + '" class="collapse">' + type.description + "</div>";
            output += '<div><i class="bi bi-patch-check-fill fs-2"></i></div>';
            output += '<div><strong>' + hoursleft.format('H') + ' hours</strong> ';
            output += 'and <strong>' + hoursleft.format('m') + ' minutes</strong></div>';
            output += 'remaining for today.';
            output += '</div>';
            
          } else {
            
            let rstart = dayjs(tomorrow.format('YYYY-MM-DD') + 'T' + range.start);
            let hoursuntil = dayjs.duration(rstart.diff(fullnow));
            
            output += '<div class="alert alert-danger text-center">';
            output += header;
            output += timerange;
            output += '<div id="desc' + count + '" class="collapse">' + type.description + "</div>";
            output += '<div><i class="bi bi-exclamation-octagon-fill fs-2"></i></div>';
            //output += '<div><strong>' + hoursuntil.format('H') + ' hours</strong> ';
            //output += 'and <strong>' + hoursuntil.format('m') + ' minutes</strong></div>';
            output += '<div><strong>Please wait</strong><br> for another time.</div>';
            output += '</div>';
            
          }
        }
      });
      output += '</div>';
    });
  });
  output += '</div>'; 
  let app = document.querySelector('#app');
  app.innerHTML = output;
  //console.log(output);
})();
// Below Easter algorithm is from 
// https://stackoverflow.com/questions/1284314/easter-date-in-javascript
function easterDateLLongre(Y) {
  let M=3, G= Y % 19+1, C= ~~(Y/100)+1, L=~~((3*C)/4)-12,
      E=(11*G+20+ ~~((8*C+5)/25)-5-L)%30, D;
  E<0 && (E+=30);
  (E==25 && G>11 || E==24) && E++;
  (D=44-E)<21 && (D+=30);
  (D+=7-(~~((5*Y)/4)-L-10+D)%7)>31 && (D-=31,M=4);
  return [Y, M, D];
}
</script>
</body>
</html>

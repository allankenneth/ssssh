<!doctype HTML>
<html lang="en">
<head>
<title>Ssssh! Victoria BC Quiet District Bylaws Made Plain</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
<script>
    var current = new Date();
    var future = new Date();
    future.setTime(future.getTime() + 3600000); //3600000 = 1 hour
    future.setMinutes(0);
    future.setSeconds(0);
    var timeout = (future.getTime() - current.getTime());
    setTimeout(function() { window.location.reload(true); }, timeout);
</script>
</head>
<body class="bg-light">
<h1 class="text-center">
    <span class="fs-3">Victoria, BC</span><br>
    <span class="display-4 fw-bold">Quiet District Bylaws</span><br>
    <span class="display-5 text-uppercase fw-lighter">Made Plain</span>
</h1>
<div class="bg-white">
<div class="container bg-white">
<div class="row pt-3">
  

<div class="col-12" id="app"></div>


<div style="height: 200px"></div>
</div>
</div>
</div>
<div class="bg-black text-white">
<div class="container">
<div class="row">
<div class="col-md-8">
<div class="py-5">
        <h1>About</h1>
        <p>This site is not affiliated with the City of Victoria, British Columbia in any way and is
        not guaranteed to be accurate. The logic is based on a reading of the bylaws and a customized
        JSON representation derived from them. You can 
        <a href="https://github.com/allankenneth/ssssh">view the code on GitHub</a>
        .</p>
        <p>Ssssh! was created in the spirit that more people would follow the bylaws and be respectful
        of their neighbors if they had an easy way to check the bylaws that didn't involve reading a 
        20 page PDF to find the relevant section relative to the current date and time.</p>
        
        <a class="btn btn-primary mb-6" href="https://www.victoria.ca/assets/City~Hall/Bylaws/bylaw-03-012.pdf">Download Bylaw PDF</a>
        <div style="height: 200px"></div>
</div>
</div>
<div class="col-md-4">
<div class="py-5">
  <h2>Acknowledgement</h2>
  <p class="fs-4">This website pertains to bylaws in the city of Victoria, BC which exists 
  on the unceded territories of the Lekwungen peoples, today known as the Songhees 
  and Esquimalt nations.</p>
</div>
</div>
</div>
</div>
</div>
<script src="https://unpkg.com/dayjs@1.8.21/dayjs.min.js"></script>
<script src="https://unpkg.com/dayjs@1.8.21/plugin/relativeTime.js"></script>
<script>

dayjs.extend(window.dayjs_plugin_relativeTime);

const today = dayjs().format('YYYY-MM-DD');
const loadedon = dayjs().format('dddd[,] MMMM D [at] h:mm');
const day = dayjs().format('d');
const hour = dayjs().format('HH');
const time = dayjs().format('HH:mm')

/**
* Holidays
*
* (a) New Yearâ€™s Day, Good Friday, Easter Monday, Victoria Day, Canada Day,
* British Columbia Day, Labour Day, Thanksgiving Day, Remembrance Day,
* Christmas Day and December 26, and
* (b) the day following a day that is named in paragraph (a) and that falls on a Sunday;
*
**/
//let sssshday = '2022-07-06';
//let newyearsday = year . '-01-01';
//let easter = '2022-05-21'; // date("Y-m-d", easter_date(let year));
//let gf = new DateTime(easter);
//let goodf = gf->sub(new DateInterval('P3D'));
//let goodfriday = goodf->format('Y-m-d');
//let victoriaday = date('Y-m-d', strtotime("last monday before may 25 let year"));
//let canadaday = year . '-07-01';
//let bcday = date('Y-m-d', strtotime("first monday of august let year"));
//let labourday = date('Y-m-d', strtotime("first monday of september let year"));
//let thanksgiving = date('Y-m-d', strtotime("second monday of october let year"));
//let rememberanceday = year . '-11-11';
//let xmasday = year . '-12-25';
//let boxingday = year . '-12-26';
//let victoriaday = year . '-01-01'; // observed on the Monday before May 25th each year
//let holidays = [
//                sssshday,
//                newyearsday,
//                goodfriday,
//                easter,
//                victoriaday,
//                canadaday,
//                bcday,
//                labourday,
//                thanksgiving,
//                rememberanceday,
//                xmasday,
//                boxingday
//        ];

let dayrange = '';
if(day == 1 || day == 2 || day == 3 || day == 4 || day == 5) {
        dayrange = 'Weekdays';
} else if (day == 6) {
        dayrange = 'Saturday';
} else if (day == 0) {
        dayrange = 'Holiday';
}
console.log(dayrange);
// elseif (in_array(let holidays,let today)) {
// dayrange = 'Holiday';
// }

(async () => {
  const res = await fetch('https://raw.githubusercontent.com/allankenneth/ssssh/main/bylaws.json', {
    headers: { Accept: 'application/json' },
  });
  const json = await res.json();
  var output = '<div class="mb-4 text-center text-uppercase fs-3">It is ' + loadedon + '</div>';
  output += '<div class="row">';
  Object.entries(json).forEach(([key, zone]) => {
    zone[0].types.forEach((type) => {
      output += '<div class="col-md-6 col-lg-4">';
      let header = '<h3>' + type.type + '</h3>'; //  <a href="#"><i class="bi bi-question-circle"></i></a>
      //output += '<div>' + type.description + "</div>";
      type.ranges.forEach((range) => {
        if(dayrange == range.name) {
          let timerange = '<div>' + range.start + ' - ';
          timerange += '' + range.end + '</div>';
          if(time > range.start && time < range.end) {
            status = 'alert-success'; //'<div class="alert alert-success">Yes, you may make noise.</div>'; //  for another ' + timeleft + '
          } else {
            status = 'alert-danger'; //'<div class="alert alert-danger">Please wait for another time to make noise.</div>';
          }
          
          if(status == 'alert-success') {
            //let fn = today + 'T' + time;
            //let fullnow = dayjs(fn);
            //let fulltime = dayjs(time);
            //let rend = dayjs(range.end);
            //let timeleft = dayjs(fn).to(rend);
            output += '<div class="alert alert-success text-center">';
            output += header;
            output += timerange;
            output += '<div><i class="bi bi-patch-check-fill fs-2"></i></div>';
            output += '<div>You may make noise.</div>';
            output += '</div>';
            
          } else if(status == 'alert-danger') {
            output += '<div class="alert alert-danger text-center">';
            output += header;
            output += timerange;
            output += '<div><i class="bi bi-exclamation-octagon-fill fs-2"></i></div>';
            output += '<div>Please, wait for another time.</div>';
            output += '</div>';
          }
        }
      });
      output += '</div>';
    });
  });
  output += '</div>'; 
  let app = document.querySelector('#app');
  app.innerHTML = output;
  //console.log(output);
})();
</script>
</body>
</html>
